---
layout: docs
permalink: connectors/elasticsearch-2.2/troubleshooting.html
---

The most common problems that occur in the context of the Couchbase-Elasticsearch data-replication system are `data-transfer failure` and `data-indexing failure`. This section describes procedures whereby you can monitor system-health; determine causes of failure; and fix problems.

## Monitoring

You should monitor all of the following:

- `Outbound XDCR operations`. In Couchbase Web Console, left-click on the **Data Buckets** tab; then, left-click on the bucket-name; and finally, open the **Outbound XDCR Operations** tab, which is located towards the bottom of the UI. This provides statistics related to data replication to Elasticsearch, including the rate of transfer:

	![](../../content/img/outboundXDCRops.png)

- _Log files._ The Elasticsearch Plug-in uses the same directory as file as Elasticsearch itself; which is located under the Elasticsearch install directory, and named `logs`.

- _Document-counts._ The number of documents in Couchbase can be compared with the number in Elasticsearch. This assumes that Couchbase has a static number of items. To get the number for Couchbase, in the Couchbase Web Console, left-click on the **Data Buckets** tab; then, examine the figure for each bucket in the **Item Count** column. For example:

	![](../../content/img/itemCount.png)

To get the number from Elasticsearch, send an HTTP request, formed as follows:

```bash
curl http://[elasticsearch_host]:9200/[index_name]/couchbaseDocument/_count
```

A successful response might appear as follows:

```json
{
		"count":7303,"_shards":
				{
						"Total":5,"successful":5,"failed":0
		}
}
```

In this response, the count has the same value as the number of items shown in the Couchbase Web Console, indicating that all items have been successfully transferred and indexed.

## Troubleshooting Data-Transfer Issues

If, by means of the monitoring procedures described above, you find evidence of data-transfer failure, proceed as follows:

- _Check your version of Elasticsearch._ Note that a plug-in version-incompatibility may produce an error message such as the following:

	```bash
	Attention - Failed to grab remote bucket info from any of known nodes
	```

	Additionally, the Elasticsearch head console may display an error message such as the following:
	
	```bash
	[2012-12-19 05:50:41758][WARN ][org.eclipse.jetty.servlet.ServletHandler]
  Error for /pools/default/buckets java.lang.NoSuchMethodError:
	```
	
- _Check destination-cluster references._ If such references were created in Couchbase Web Console, and the replication itself was created and started subsequently, IP addresses potentially underwent change in the interim: this occurrence is especially likely if a laptop is used as the administration-platform.
  In such a case, the following error appears in the Status area of the **Ongoing Replications** tab, on the **XDCR** view provided by Couchbase Web Console:
  
  ```bash
  2013-01-28 15:07:10 - Error replicating vbucket 56: {badmatch, {error,all_nodes_failed, 
  <<"Failed to grab remote bucket info from Any of known nodes">>}}
  ```
  
  To resolve the problem, check remote Elasticsearch references in XDCR, and correct IP addresses where appropriate.

## Troubleshooting Indexing Issues

If you find that Couchbase items do not get indexed, or that unexpected items appear in Elasticsearch query-responses, proceed as follows:

- _Change_ the `refresh_interval-setting` to a reduced number of seconds. See [Update Indices Settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html) in the Elasticsearch online documentation.
- _Check Elasticsearch mappings._ Such mappings are automatically generated by default; and this involves assumptions about data types and structures within the imported documents. In consequence, objects may be omitted: for example, objects within an array. See [Mapping](https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html), in the Elasticsearch online documentation.
- _Check documents, to ensure that all are well-formed JSON._ Note that whereas, when JSON is not well-formed, the plug-in both accepts binary data and logs error messages, Elasticsearch itself _cannot index any such data_.

## Enabling Logging

You can configure the Couchbase Transport logging facility by editing the file `./config/logging.yml`, and adding the following lines to the logger section:

```bash
Transport.couchbase: TRACE com.couchbase: TRACE
```

For information, see [Logging](https://www.elastic.co/guide/en/elasticsearch/guide/current/logging.html), in the Elasticsearch online documentation.