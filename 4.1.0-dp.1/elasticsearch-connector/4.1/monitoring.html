<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Monitoring | Couchbase Docs</title>
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="elasticsearch-connector">
    <meta name="dcterms.identifier" content="4.1">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://docs.couchbase.com">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../../server/6.0/introduction/intro.html">Server</a></li>
                  <li><a href="../../server/6.0/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server/6.0/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server/6.0/analytics/introduction.html">Analytics</a></li>
                  <li><a href="../../server/6.0/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="#">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="#">Lite</a></li>
                  <li><a href="#">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server/6.0/sdk/overview.html">SDKs</a></li>
                  <li><a href="../../c-sdk/2.10/start-using-sdk.html">C</a></li>
                  <li><a href="../../dotnet-sdk/2.7/start-using-sdk.html">.NET</a></li>
                  <li><a href="../../go-sdk/1.5/start-using-sdk.html">Go</a></li>
                  <li><a href="../../java-sdk/2.7/start-using-sdk.html">Java</a></li>
                  <li><a href="../../nodejs-sdk/2.6/start-using-sdk.html">Node.js</a></li>
                  <li><a href="../../php-sdk/2.6/start-using-sdk.html">PHP</a></li>
                  <li><a href="../../python-sdk/2.5/start-using-sdk.html">Python</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server/6.0/connectors/intro.html">Connectors</a></li>
                  <li><a href="index.html">Elasticsearch</a></li>
                  <li><a href="../../server/6.0/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="#">Kafka</a></li>
                  <li><a href="#">Spark</a></li>
                  <li><a href="#">Talend</a></li>
                  <li><a href="../../server/6.0/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <a class="navbar-item component" href="index.html"><span class="title">Elasticsearch Connector</span> <span class="version">4.1 Developer Preview</span></a>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-current-path is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="index.html">Elasticsearch Connector</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="configuration.html">Configuration</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="autonomous-operations.html">Autonomous Operations</a>
    </span>
  </li>
  <li class="nav-item is-current-page is-active" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="monitoring.html">Monitoring</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="secure-connections.html">Secure Connections</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="migration.html">Migration</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="release-notes.html">Release Notes</a>
    </span>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Elasticsearch Connector</a></li>
    <li class="crumb"><a href="monitoring.html">Monitoring</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="https://github.com/couchbase/couchbase-elasticsearch-connector/edit/master/docs/modules/ROOT/pages/monitoring.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">Monitoring</h1>
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
The connector exposes several performance metrics.
Here&#8217;s a summary of the most important metrics and how to interpret them.
</blockquote>
</div>
<div class="paragraph">
<p>In its default configuration, the connector runs an embedded web server.
Metrics are exposed at <code><a href="http://localhost:31415/metrics?pretty" class="bare">http://localhost:31415/metrics?pretty</a></code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Omit the <code>?pretty</code> for a more compact response.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A simple health check might fetch that URL and assert the response has an HTTP status code of 200 (OK).
A more sophisticated check should parse the JSON response and inspect the values of whichever metrics you consider important.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-server-config"><a class="anchor" href="#http-server-config"></a>HTTP Server Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To disable the embedded HTTP server or to use an alternate port, edit the connector config and search for the <code>httpPort</code> property in the <code>[metrics]</code> section.
Setting the port to <code>-1</code> will disable the HTTP server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="logging"><a class="anchor" href="#logging"></a>Logging Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to exposing metrics over HTTP, by default the connector periodically logs the metrics to <code>$CBES_HOME/logs/cbes-metrics.log</code>.</p>
</div>
<div class="paragraph">
<p>In the <code>[metrics]</code> section of the connector config file you can configure the interval at which metrics written to the log by modifying the <code>logInterval</code> property.
Metrics logging can be disabled by setting the interval to <code>'0m'</code>.</p>
</div>
<div class="paragraph">
<p>The location of the metrics log file is configurable in <code>$CBES_HOME/config/log4j2.xml</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics"><a class="anchor" href="#metrics"></a>Metrics Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The connector uses the Dropwizard Metrics library to capture and report performance information.
This section describes the metrics exposed by the connector and how to interpret them.</p>
</div>
<div class="sect2">
<h3 id="gauges"><a class="anchor" href="#gauges"></a>Gauges</h3>
<div class="paragraph">
<p>A gauge is a single value that represents the current state of something.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>cbes.esWaitMs</code></dt>
<dd>
<p>Perhaps the most important metric for implementing a health check, this gauge reports the duration in milliseconds of the current in-flight Elasticsearch bulk request.
This includes the time it takes to retry the request, if necessary.
An exceptionally long duration might indicate the connector is stalled in a retry loop.</p>
</dd>
<dt class="hdlist1"><code>cbes.backfill</code></dt>
<dd>
<p>This is the number of Couchbase documents not yet replicated to Elasticsearch at the time the connector started.
The value reported by this gauge never changes.</p>
</dd>
<dt class="hdlist1"><code>cbes.backfillRemaining</code></dt>
<dd>
<p>Shows how many documents the connector still needs to process in order to catch up with the state of the bucket when the connector started.
The value only decreases, and never goes below zero.</p>
</dd>
<dt class="hdlist1"><code>cbes.backfillEstTimeLeft</code></dt>
<dd>
<p>A rough estimate of the time it will take for the connector to finish processing the remaining backfill.</p>
</dd>
<dt class="hdlist1"><code>cbes.writeQueue</code></dt>
<dd>
<p>Reports the number of document events currently buffered in memory. (The write queue is implicitly bounded by the <code>flowControlBuffer</code> config property which determines the buffer size.)</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="meters"><a class="anchor" href="#meters"></a>Meters</h3>
<div class="paragraph">
<p>A meter records the rate at which an event occurs, and also the total number of occurrences.
It reports a mean rate since the connector started, as well as 1-, 5-, and 15-minute exponentially weighted moving averages.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>cbes.throughputBytes</code></dt>
<dd>
<p>An estimate of the number of bytes the connector has written to Elasticsearch.</p>
</dd>
<dt class="hdlist1"><code>cbes.bulkRetry</code></dt>
<dd>
<p>Recorded whenever an Elasticsearch bulk request is retried due to a temporary failure.</p>
</dd>
<dt class="hdlist1"><code>cbes.docWriteRetry</code></dt>
<dd>
<p>Recorded for each document being retried. (For each <code>bulkRetry</code> event, one or more <code>docWriteRetry</code> events are recorded, indicating how many failures there were in the bulk request.)</p>
</dd>
<dt class="hdlist1"><code>cbes.docRejected</code></dt>
<dd>
<p>Recorded when there is a permanent indexing failure.
These failures usually result in an entry being added to the rejection log Elasticsearch index.</p>
</dd>
<dt class="hdlist1"><code>cbes.rejectionLogFail</code></dt>
<dd>
<p>Recorded when the connector is unable to add a record to the rejection log Elasticsearch index.</p>
</dd>
<dt class="hdlist1"><code>cbes.esConnFail</code></dt>
<dd>
<p>Recorded when the connector fails to establish a connection to Elasticsearch.</p>
</dd>
<dt class="hdlist1"><code>cbes.saveStateFail</code></dt>
<dd>
<p>Recorded when the connector fails to persist a replication checkpoint document to Couchbase.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="timers"><a class="anchor" href="#timers"></a>Timers</h3>
<div class="paragraph">
<p>A timer combines a meter with a histogram of event durations, providing insight into the percentiles.
The histogram is backed by an exponentially decaying reservoir, representing roughly the past 5 minutes of data.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>cbes.latency</code></dt>
<dd>
<p>The time between when the connector is notified of a database change and when the change is written to Elasticsearch.
Bear in mind the connector will not receive the event until there is room in its flow control buffer.
Although this metric is not an absolute measurement of end-to-end latency, it is still useful as an indicator of connector performance.</p>
</dd>
<dt class="hdlist1"><code>cbes.bulkIndexPerDoc</code></dt>
<dd>
<p>The duration of an Elasticsearch bulk request (including retries), divided by the number of items in the bulk request.</p>
</dd>
<dt class="hdlist1"><code>cbes.retryDelay</code></dt>
<dd>
<p>Time spent waiting after a temporary indexing failure before the request is retried.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="undocumented-metrics"><a class="anchor" href="#undocumented-metrics"></a>Undocumented Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The connector exposes several other metrics that are useful for troubleshooting.
However, only the metrics described in this document are considered part of the connector&#8217;s public API.
Undocumented metrics should be considered "uncommitted", meaning they may be modified or removed in a patch release without advance notice.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">3250 Olcott Street
Santa Clara, CA 95054
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://learn.couchbase.com/store" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/mark.js"></script>
  </body>
</html>
